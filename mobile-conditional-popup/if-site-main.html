<html>

<head>
    <title>테스트</title>
</head>

<body>
    <script>
        let version

        const checkMobile = () => {
            var varUA = navigator.userAgent.toLowerCase(); //userAgent 값 얻기

            if (varUA.indexOf('android') > -1) {
                //안드로이드
                return "android";
            } else if (varUA.indexOf("iphone") > -1 || varUA.indexOf("ipad") > -1 || varUA.indexOf("ipod") > -1) {
                //IOS
                return "ios";
            } else {
                //아이폰, 안드로이드 외
                return "other";
            }
        }

        const get_data = (data) => {
            splitedVersion = data.split(".").map(Number);
            version = splitedVersion;
        }

        const checkVersion = () => {
            setTimeout(function () {
                webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({ "action": "appversion", "callback": "get_data" }));
            }, 500);
        }

        const updatePopup = (storeUrl) => {
            let popupUpdateCheck = confirm("앱을 업데이트하세요.")
            if (popupUpdateCheck)
                location.href = storeUrl; //,'width=500,height=500,resizable=no'
        }

        const selectOsStore = (rawRecentAppVersion, os, storeId) => {
            recentAppVersion = rawRecentAppVersion.split(".").map(Number);
            checkVersion()
            setTimeout(function () {
                if (
                    (version[0] < recentAppVersion[0]) ||
                    (version[1] < recentAppVersion[1]) ||
                    (version[2] < recentAppVersion[2])
                ) {
                    if (os === "android") { // 업데이트를 위해 플레이스토어로 이등
                        updatePopup("market://details?id="+storeId);
                    } else if (os === "ios") { // 업데이트를 위해 앱스토어로 이등
                        updatePopup("itms-apps://itunes.apple.com/app/"+storeId); // "itms-apps://itunes.apple.com/app/" + appId;
                    } else {
                        console.log("모바일 기기가 아닙니다.");
                    }
                } else { // 버전 똑같음.
                    alert("버전이 똑같아서 업데이트가 필요 없어요!")
                }
            }, 1000);
        }
    </script>

    <script>
        const androidStoreId = "com.naver.labs.translator";
        const iosStoreId = "1147874819";

        try {
            const os = checkMobile();
            if(os === "android"){
                selectOsStore("2.0.5", os, androidStoreId);
            }
            else if(os === "ios"){
                selectOsStore("1.0.3", os, iosStoreId);
            }
        } catch (e) {
            alert(e);
        }
    </script>

    <div>당신의 버전은?</div>
</body>

</html>